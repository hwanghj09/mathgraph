<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‹¤ì¤‘ ê·¸ë˜í”„ ìˆ˜í•™ ê³„ì‚°ê¸°</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/function-plot/1.20.0/function-plot.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f9;
      padding: 30px;
      text-align: center;
      margin-right: 180px; /* ê´‘ê³  ê³µê°„ í™•ë³´ */
    }

    .ad-container {
      position: fixed;
      right: 0;
      top: 0;
      width: 160px;
      height: 100vh;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    h1 {
      color: #333;
    }

    .section {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
      max-width: 700px;
    }

    input, select, button {
      padding: 10px;
      font-size: 16px;
      margin: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .function-input {
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .function-input input {
      margin: 2px;
    }

    .color-indicator {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #333;
      display: inline-block;
      margin-right: 5px;
    }

    .remove-btn {
      background-color: #dc3545;
      padding: 5px 10px;
      font-size: 14px;
    }

    .remove-btn:hover {
      background-color: #c82333;
    }

    #result {
      font-size: 20px;
      margin-top: 20px;
      color: green;
    }

    #clock {
      font-size: 24px;
      font-weight: bold;
      color: #444;
    }



    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: 10px;
      padding: 10px;
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 5px;
    }

    .help-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <!-- ê´‘ê³  ì˜ì—­ -->
  <div class="ad-container">
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-3yR2TTH8GiPZXjbK"
    data-ad-width = "160"
    data-ad-height = "600"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
  </div>

  <h1>ğŸ“Š ë‹¤ì¤‘ í•¨ìˆ˜ ê·¸ë˜í”„ ìˆ˜í•™ ê³„ì‚°ê¸°</h1>

  <div class="section">
    <div id="clock">í˜„ì¬ ì‹œê°: ë¡œë”© ì¤‘...</div>
  </div>

  <div class="section">
    <h2>ğŸ§® ê³„ì‚°ê¸°</h2>
    <input type="number" id="num1" placeholder="ìˆ«ì 1">
    <select id="operation">
      <option value="add">ë”í•˜ê¸° (+)</option>
      <option value="subtract">ë¹¼ê¸° (-)</option>
      <option value="multiply">ê³±í•˜ê¸° (Ã—)</option>
      <option value="divide">ë‚˜ëˆ„ê¸° (Ã·)</option>
      <option value="power">ê±°ë“­ì œê³± (^)</option>
      <option value="sqrt">ì œê³±ê·¼ (âˆš)</option>
      <option value="log">ë¡œê·¸ (logâ‚â‚€)</option>
      <option value="ln">ìì—°ë¡œê·¸ (ln)</option>
      <option value="factorial">íŒ©í† ë¦¬ì–¼ (!)</option>
    </select>
    <input type="number" id="num2" placeholder="ìˆ«ì 2 (í•„ìš” ì‹œ)">
    <br>
    <button onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
    <div id="result"></div>
  </div>

  <div class="section">
    <h2>ğŸ“ˆ ì—¬ëŸ¬ í•¨ìˆ˜ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°</h2>
    <div class="help-text">
      ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜: x^2, sin(x), cos(x), tan(x), log(x), sqrt(x), abs(x), exp(x) ë“±<br>
      ì˜ˆì‹œ: x^2 + 2*x - 1, sin(x) * cos(x), log(x + 1)
    </div>
    <div id="functions">
      <div class="function-input">
        <div class="color-indicator" style="background-color: hsl(0, 70%, 50%);"></div>
        <input type="text" placeholder="í•¨ìˆ˜ ì´ë¦„ (ì˜ˆ: f(x))" class="label">
        <input type="text" placeholder="í•¨ìˆ˜ì‹ ì…ë ¥ (ì˜ˆ: x^2)" class="func">
        <button class="remove-btn" onclick="removeFunctionInput(this)">ì‚­ì œ</button>
      </div>
    </div>
    <button onclick="addFunctionInput()">í•¨ìˆ˜ ì¶”ê°€ â•</button>
    <button onclick="plotGraph()">ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ğŸ“Š</button>
    <button onclick="clearGraph()">ê·¸ë˜í”„ ì´ˆê¸°í™” ğŸ—‘ï¸</button>
    <div id="error-display"></div>
    <div id="plot" style="cursor: crosshair; margin: 20px 0;"></div>
  </div>



  <script>
    function calculate() {
      const n1 = parseFloat(document.getElementById("num1").value);
      const n2 = parseFloat(document.getElementById("num2").value);
      const op = document.getElementById("operation").value;
      let result;

      if (isNaN(n1) && op !== "factorial") {
        document.getElementById("result").textContent = "ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
      }

      switch (op) {
        case "add": result = n1 + n2; break;
        case "subtract": result = n1 - n2; break;
        case "multiply": result = n1 * n2; break;
        case "divide": result = n2 !== 0 ? n1 / n2 : "0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; break;
        case "power": result = Math.pow(n1, n2); break;
        case "sqrt": result = n1 >= 0 ? Math.sqrt(n1) : "ìŒìˆ˜ëŠ” ì œê³±ê·¼ì´ ì—†ìŠµë‹ˆë‹¤."; break;
        case "log": result = n1 > 0 ? Math.log10(n1) : "ì–‘ìˆ˜ë§Œ ë¡œê·¸ ê³„ì‚° ê°€ëŠ¥."; break;
        case "ln": result = n1 > 0 ? Math.log(n1) : "ì–‘ìˆ˜ë§Œ ìì—°ë¡œê·¸ ê³„ì‚° ê°€ëŠ¥."; break;
        case "factorial":
          if (n1 < 0 || !Number.isInteger(n1)) {
            result = "ìŒìˆ˜ ë˜ëŠ” ì†Œìˆ˜ì˜ íŒ©í† ë¦¬ì–¼ì€ ì •ì˜ë˜ì§€ ì•ŠìŒ.";
          } else {
            result = 1;
            for (let i = 2; i <= n1; i++) result *= i;
          }
          break;
      }

      document.getElementById("result").textContent = `ê²°ê³¼: ${result}`;
    }

    function addFunctionInput() {
      const container = document.getElementById("functions");
      const functionCount = container.children.length;
      const color = `hsl(${functionCount * 60}, 70%, 50%)`;
      
      const div = document.createElement("div");
      div.className = "function-input";
      div.innerHTML = `
        <div class="color-indicator" style="background-color: ${color};"></div>
        <input type="text" placeholder="í•¨ìˆ˜ ì´ë¦„ (ì˜ˆ: f(x))" class="label">
        <input type="text" placeholder="í•¨ìˆ˜ì‹ ì…ë ¥ (ì˜ˆ: x^2)" class="func">
        <button class="remove-btn" onclick="removeFunctionInput(this)">ì‚­ì œ</button>
      `;
      container.appendChild(div);
      updateColorIndicators();
    }

    function removeFunctionInput(button) {
      const functionInput = button.parentElement;
      functionInput.remove();
      updateColorIndicators();
    }

    function updateColorIndicators() {
      const functionInputs = document.querySelectorAll(".function-input");
      functionInputs.forEach((input, index) => {
        const colorIndicator = input.querySelector(".color-indicator");
        const color = `hsl(${index * 60}, 70%, 50%)`;
        colorIndicator.style.backgroundColor = color;
      });
    }

    function showError(message) {
      const errorDiv = document.getElementById("error-display");
      errorDiv.innerHTML = `<div class="error-message">${message}</div>`;
      setTimeout(() => {
        errorDiv.innerHTML = '';
      }, 5000);
    }

    function plotGraph() {
      const functionInputs = document.querySelectorAll(".func");
      const labelInputs = document.querySelectorAll(".label");
      const data = [];
      let hasValidFunction = false;

      // í•¨ìˆ˜ ë°ì´í„° ì²˜ë¦¬
      for (let i = 0; i < functionInputs.length; i++) {
        const expr = functionInputs[i].value.trim();
        const label = labelInputs[i].value.trim() || `f${i+1}(x)`;

        if (expr) {
          try {
            // í•¨ìˆ˜ì‹ ê²€ì¦ì„ ìœ„í•œ ì„ì‹œ í…ŒìŠ¤íŠ¸
            const testExpr = expr.replace(/\^/g, '**'); // ^ ë¥¼ ** ë¡œ ë³€í™˜
            new Function('x', `return ${testExpr}`)(1); // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            
            data.push({
              fn: expr,
              label: label,
              graphType: 'polyline',
              color: `hsl(${i * 60}, 70%, 50%)`
            });
            hasValidFunction = true;
          } catch (error) {
            showError(`í•¨ìˆ˜ì‹ ì˜¤ë¥˜ (${label}): "${expr}"<br>ì˜¬ë°”ë¥¸ ì˜ˆì‹œ: x^2, sin(x), cos(x), x^2 + 2*x - 1`);
            return;
          }
        }
      }

      if (!hasValidFunction) {
        showError("í•¨ìˆ˜ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      try {
        document.getElementById("error-display").innerHTML = '';
        functionPlot({
          target: '#plot',
          width: 600,
          height: 400,
          grid: true,
          xAxis: { 
            label: 'x',
            domain: [-10, 10]
          },
          yAxis: { 
            label: 'y',
            domain: [-10, 10]
          },
          data: data,
          tip: {
            xLine: true,
            yLine: true,
            renderer: function(x, y, index) {
              const roundedX = Math.round(x * 100) / 100;
              const roundedY = Math.round(y * 100) / 100;
              const functionLabel = data[index] ? data[index].label : '';
              return `${functionLabel}<br>x: ${roundedX}, y: ${roundedY}`;
            }
          }
        });
      } catch (err) {
        showError("ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        console.error(err);
      }
    }

    function clearGraph() {
      document.getElementById('plot').innerHTML = '';
      document.getElementById("error-display").innerHTML = '';
    }

    function updateClock() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString("ko-KR");
      document.getElementById("clock").textContent = "í˜„ì¬ ì‹œê°: " + timeStr;
    }
    
    setInterval(updateClock, 1000);
    updateClock();

    // ì´ˆê¸° ê·¸ë˜í”„ ì„¤ì •
    window.addEventListener('load', function() {
      setTimeout(() => {
        plotGraph();
      }, 100);
    });
  </script>

</body>
</html>